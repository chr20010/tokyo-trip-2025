<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>紅葉狩り 2025 - 行程助手</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- 全局設定 --- */
        :root {
            --bg-color: #f4f1ea; /* 和紙色 */
            --primary-color: #b93a32; /* 紅葉紅 */
            --text-color: #4a4a4a;
            --accent-color: #d4ac5d; /* 金色點綴 */
            --card-bg: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: "Yu Mincho", "Hiragino Mincho ProN", "MS PMincho", serif;
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- 紅葉特效 --- */
        .falling-leaves {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .leaf {
            position: absolute;
            top: -10%;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23b93a32'%3E%3Cpath d='M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C8.58,15.06 10.13,10.59 18.88,11.24C19.09,11.26 19.2,11.09 19.07,10.93L17,8Z' /%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.6;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            100% { transform: translateY(110vh) translateX(20vw) rotate(360deg); opacity: 0; }
        }

        /* --- App 容器 --- */
        #app {
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px; /* 給底部導航留空間 */
        }

        /* --- 頂部導航 --- */
        header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        h1 { margin: 0; font-size: 1.2rem; font-weight: normal; letter-spacing: 2px; }
        .date-display { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; }

        /* --- 天氣區塊 --- */
        .weather-banner {
            background: #fff;
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        .weather-link {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- 行程時間軸 --- */
        .timeline {
            padding: 20px 15px;
        }
        .event-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .event-time {
            font-weight: bold;
            color: var(--primary-color);
            font-family: sans-serif;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        .event-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .event-location {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- 筆記與照片 --- */
        .note-section {
            border-top: 1px dashed #ccc;
            padding-top: 10px;
            margin-top: 10px;
        }
        textarea {
            width: 100%;
            border: 1px solid #ddd;
            background: #fdfdfd;
            border-radius: 4px;
            padding: 8px;
            font-family: inherit;
            resize: vertical;
            min-height: 40px;
            box-sizing: border-box;
            font-size: 0.9rem;
        }
        .photo-upload {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .photo-preview {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #ddd;
        }
        .add-photo-btn {
            width: 60px;
            height: 60px;
            background: #eee;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #888;
            font-size: 1.2rem;
        }
        input[type="file"] { display: none; }

        /* --- 記帳區塊 --- */
        .expense-section {
            background: #fff;
            margin: 0 15px 20px;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--accent-color);
        }
        .expense-header {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .expense-list {
            list-style: none;
            padding: 0;
            margin: 0 0 10px 0;
        }
        .expense-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted #eee;
            font-size: 0.9rem;
        }
        .expense-input {
            display: flex;
            gap: 5px;
        }
        .expense-input input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        .btn-add {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* --- 底部導航 --- */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            box-sizing: border-box;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            max-width: 600px;
            left: 50%;
            transform: translateX(-50%);
        }
        .nav-btn {
            background: transparent;
            border: none;
            color: var(--primary-color);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            opacity: 0.7;
        }
        .nav-btn.active { opacity: 1; font-weight: bold; }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* --- 動畫過渡 --- */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        .clear-data {
            text-align: center;
            margin-top: 20px;
            font-size: 0.8rem;
            color: #aaa;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="falling-leaves">
        <div v-for="n in 15" :key="n" class="leaf" :style="getLeafStyle()"></div>
    </div>

    <header>
        <h1>河口湖鎌倉東京紅葉狩り</h1>
        <div class="date-display">Day {{ currentDayIndex + 1 }} · {{ currentDayData.date }}</div>
    </header>

    <div class="weather-banner">
        <i class="fa-solid fa-cloud-sun"></i>
        <span>當地平均氣候參考：</span>
        <a :href="currentDayData.weatherUrl" target="_blank" class="weather-link">
            Tenki.jp <i class="fa-solid fa-up-right-from-square"></i>
        </a>
    </div>

    <transition name="fade" mode="out-in">
        <div class="timeline" :key="currentDayIndex">
            <div v-for="(event, index) in currentDayData.events" :key="index" class="event-card">
                <div class="event-time">{{ event.time }}</div>
                <div class="event-title">{{ event.place }}</div>
                <div class="event-location">
                    <i class="fa-solid fa-location-dot"></i> {{ event.place }}
                </div>

                <div class="note-section">
                    <textarea v-model="event.userNote" placeholder="在此記錄旅行心情..." @input="saveData"></textarea>
                    
                    <div class="photo-upload">
                        <img v-for="(img, i) in event.photos" :src="img" class="photo-preview" @click="removePhoto(event, i)">
                        <label class="add-photo-btn">
                            <i class="fa-solid fa-camera"></i>
                            <input type="file" accept="image/*" @change="(e) => handlePhotoUpload(e, event)">
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </transition>

    <div class="expense-section">
        <div class="expense-header">
            <span><i class="fa-solid fa-yen-sign"></i> 本日消費</span>
            <span>合計: ¥{{ dayTotal(currentDayIndex) }}</span>
        </div>
        <ul class="expense-list">
            <li v-for="(item, idx) in currentDayData.expenses" :key="idx" class="expense-item">
                <span>{{ item.desc }}</span>
                <span>¥{{ item.cost }} <i class="fa-solid fa-trash" style="color:#ccc; font-size:0.8rem; margin-left:5px; cursor:pointer;" @click="removeExpense(idx)"></i></span>
            </li>
        </ul>
        <div class="expense-input">
            <input v-model="newExpenseDesc" placeholder="項目 (如: 拉麵)" style="flex:2">
            <input v-model="newExpenseCost" type="number" placeholder="金額" style="flex:1">
            <button class="btn-add" @click="addExpense">記帳</button>
        </div>
    </div>
    
    <div class="clear-data" @click="clearAllData">清除所有資料 (重置)</div>

    <div class="nav-bar">
        <button class="nav-btn" @click="prevDay" :disabled="currentDayIndex === 0">
            <i class="fa-solid fa-chevron-left"></i> 上一天
        </button>
        <button class="nav-btn" @click="goToday">
            <i class="fa-solid fa-calendar-day"></i> 今天
        </button>
        <button class="nav-btn" @click="nextDay" :disabled="currentDayIndex === days.length - 1">
            下一天 <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentDayIndex: 0,
                newExpenseDesc: '',
                newExpenseCost: '',
                // 原始行程資料
                days: [
                    {
                        date: "2025/12/06 (六)",
                        region: "yamanashi", // 用於天氣判斷
                        weatherUrl: "https://tenki.jp/forecast/4/19/4920/19430/", // 河口湖
                        events: [
                            { time: "06:10", place: "TSA·臺北松山機場", userNote: "", photos: [] },
                            { time: "13:00", place: "HND·東京國際機場(羽田機場)", userNote: "", photos: [] },
                            { time: "15:51", place: "秀峰閣湖月", userNote: "", photos: [] },
                            { time: "16:36", place: "日川時計店", userNote: "", photos: [] },
                            { time: "17:24", place: "金鳥居", userNote: "", photos: [] },
                            { time: "18:11", place: "河口湖", userNote: "", photos: [] },
                            { time: "18:24", place: "秀峰閣湖月", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/07 (日)",
                        region: "yamanashi",
                        weatherUrl: "https://tenki.jp/forecast/4/19/4920/19430/",
                        events: [
                            { time: "09:00", place: "秀峰閣湖月", userNote: "", photos: [] },
                            { time: "10:30", place: "長池親水公園", userNote: "", photos: [] },
                            { time: "11:03", place: "Noah or THE PARK", userNote: "", photos: [] },
                            { time: "13:46", place: "Saiko Nenba-hama", userNote: "", photos: [] },
                            { time: "14:27", place: "精進湖 石碑", userNote: "", photos: [] },
                            { time: "15:10", place: "本栖湖展望公園", userNote: "", photos: [] },
                            { time: "16:17", place: "秀峰閣湖月", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/08 (一)",
                        region: "yamanashi",
                        weatherUrl: "https://tenki.jp/forecast/4/19/4920/19430/",
                        events: [
                            { time: "07:00", place: "秀峰閣湖月", userNote: "", photos: [] },
                            { time: "08:41", place: "長崎公園", userNote: "", photos: [] },
                            { time: "09:26", place: "大石公園", userNote: "", photos: [] },
                            { time: "10:19", place: "河口湖楓葉迴廊", userNote: "", photos: [] },
                            { time: "10:50", place: "秀峰閣湖月", userNote: "", photos: [] },
                            { time: "11:00", place: "古屋炸物小店", userNote: "", photos: [] },
                            { time: "12:50", place: "河口湖駅", userNote: "", photos: [] },
                            { time: "14:57", place: "ＢＵＳＴＡ新宿", userNote: "", photos: [] },
                            { time: "15:10", place: "Pomme d'Amour Tokyo", userNote: "", photos: [] },
                            { time: "16:00", place: "旭川成吉思汗 大黑屋", userNote: "", photos: [] },
                            { time: "18:14", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "19:02", place: "迴轉壽司 Toriton", userNote: "", photos: [] },
                            { time: "20:04", place: "Qu'il fait bon", userNote: "", photos: [] },
                            { time: "20:19", place: "東京晴空塔城", userNote: "", photos: [] },
                            { time: "22:29", place: "十間橋", userNote: "", photos: [] },
                            { time: "23:14", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/09 (二)",
                        region: "chiba", // 迪士尼在千葉
                        weatherUrl: "https://tenki.jp/forecast/3/15/4510/12227/", // 浦安市
                        events: [
                            { time: "07:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "07:49", place: "東京迪士尼海洋", userNote: "", photos: [] },
                            { time: "17:00", place: "東京迪士尼樂園", userNote: "", photos: [] },
                            { time: "21:52", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "22:00", place: "Saichi", userNote: "", photos: [] },
                            { time: "23:08", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/10 (三)",
                        region: "tokyo",
                        weatherUrl: "https://tenki.jp/forecast/3/16/4410/13101/", // 東京千代田
                        events: [
                            { time: "08:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "08:35", place: "立教大学本館", userNote: "", photos: [] },
                            { time: "10:00", place: "Chiikawa Park", userNote: "", photos: [] },
                            { time: "12:15", place: "yellow 池袋", userNote: "", photos: [] },
                            { time: "14:20", place: "新宿御苑", userNote: "", photos: [] },
                            { time: "16:00", place: "The Front Room Deli", userNote: "", photos: [] },
                            { time: "17:33", place: "丸の内イルミネーション", userNote: "", photos: [] },
                            { time: "18:38", place: "茅乃舍 東京站店", userNote: "", photos: [] },
                            { time: "19:24", place: "五代目 花山烏冬", userNote: "", photos: [] },
                            { time: "21:19", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/11 (四)",
                        region: "tokyo",
                        weatherUrl: "https://tenki.jp/forecast/3/16/4410/13120/", // 練馬區(哈利波特)
                        events: [
                            { time: "08:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "10:00", place: "華納兄弟哈利波特影城", userNote: "", photos: [] },
                            { time: "15:46", place: "Iruca Tokyo Roppongi", userNote: "", photos: [] },
                            { time: "16:49", place: "MIDTOWN CHRISTMAS", userNote: "", photos: [] },
                            { time: "18:05", place: "けやき坂イルミネーション", userNote: "", photos: [] },
                            { time: "19:37", place: "Shuhari Stone-ground Udon", userNote: "", photos: [] },
                            { time: "20:42", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/12 (五)",
                        region: "kanagawa",
                        weatherUrl: "https://tenki.jp/forecast/3/17/4610/14204/", // 鎌倉
                        events: [
                            { time: "08:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "09:15", place: "北鎌倉站", userNote: "", photos: [] },
                            { time: "09:20", place: "圓覺寺", userNote: "", photos: [] },
                            { time: "10:36", place: "杉養蜂園 鎌倉3號店", userNote: "", photos: [] },
                            { time: "11:00", place: "Kamakura Rokuyata", userNote: "", photos: [] },
                            { time: "12:57", place: "七里ヶ浜海岸", userNote: "", photos: [] },
                            { time: "14:00", place: "bills 七里ヶ浜", userNote: "", photos: [] },
                            { time: "15:43", place: "稻村崎公園", userNote: "", photos: [] },
                            { time: "17:03", place: "鐮倉", userNote: "", photos: [] },
                            { time: "17:40", place: "橫濱車站", userNote: "", photos: [] },
                            { time: "17:51", place: "ちいかわ焼き横浜", userNote: "", photos: [] },
                            { time: "18:29", place: "横浜赤レンガ倉庫", userNote: "", photos: [] },
                            { time: "19:45", place: "橫濱車站", userNote: "", photos: [] },
                            { time: "20:34", place: "洋食 Shiratsuyu", userNote: "", photos: [] },
                            { time: "21:41", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/13 (六)",
                        region: "tokyo",
                        weatherUrl: "https://tenki.jp/forecast/3/16/4410/13103/", // 港區
                        events: [
                            { time: "09:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "09:48", place: "豪徳寺 招福殿", userNote: "", photos: [] },
                            { time: "10:56", place: "Mahorodou Sougetsu", userNote: "", photos: [] },
                            { time: "11:24", place: "RARASAND", userNote: "", photos: [] },
                            { time: "12:00", place: "canteen kado", userNote: "", photos: [] },
                            { time: "13:58", place: "明治神宮外苑銀杏林", userNote: "", photos: [] },
                            { time: "15:27", place: "大手仮休憩所（売店）", userNote: "", photos: [] },
                            { time: "16:28", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "17:43", place: "御台場海濱公園", userNote: "", photos: [] },
                            { time: "17:45", place: "お台場燈光秀 YAKEI", userNote: "", photos: [] },
                            { time: "18:53", place: "KING OF THE PIRATES", userNote: "", photos: [] },
                            { time: "20:12", place: "Aocho Oden", userNote: "", photos: [] },
                            { time: "21:48", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] }
                        ],
                        expenses: []
                    },
                    {
                        date: "2025/12/14 (日)",
                        region: "tokyo",
                        weatherUrl: "https://tenki.jp/forecast/3/16/4410/13111/", // 大田區(羽田)
                        events: [
                            { time: "11:00", place: "Tobu Hotel Levant Tokyo", userNote: "", photos: [] },
                            { time: "11:57", place: "羽田機場花園 (午餐)", userNote: "", photos: [] },
                            { time: "15:10", place: "HND·東京國際機場", userNote: "", photos: [] },
                            { time: "21:00", place: "TSA·臺北松山機場", userNote: "", photos: [] }
                        ],
                        expenses: []
                    }
                ]
            }
        },
        computed: {
            currentDayData() {
                return this.days[this.currentDayIndex];
            }
        },
        mounted() {
            this.loadData();
        },
        methods: {
            prevDay() {
                if(this.currentDayIndex > 0) {
                    this.currentDayIndex--;
                    window.scrollTo(0,0);
                }
            },
            nextDay() {
                if(this.currentDayIndex < this.days.length - 1) {
                    this.currentDayIndex++;
                    window.scrollTo(0,0);
                }
            },
            goToday() {
                // 簡單邏輯：跳到第一天，或根據實際日期判斷（若在2025年時可用）
                // 這裡預設跳回第一天方便檢視
                this.currentDayIndex = 0;
                window.scrollTo(0,0);
            },
            getLeafStyle() {
                return {
                    left: Math.random() * 100 + 'vw',
                    animationDuration: (Math.random() * 5 + 5) + 's',
                    animationDelay: (Math.random() * 5) + 's'
                }
            },
            dayTotal(dayIdx) {
                const expenses = this.days[dayIdx].expenses;
                if(!expenses) return 0;
                return expenses.reduce((sum, item) => sum + Number(item.cost), 0);
            },
            addExpense() {
                if(this.newExpenseDesc && this.newExpenseCost) {
                    this.currentDayData.expenses.push({
                        desc: this.newExpenseDesc,
                        cost: this.newExpenseCost
                    });
                    this.newExpenseDesc = '';
                    this.newExpenseCost = '';
                    this.saveData();
                }
            },
            removeExpense(idx) {
                if(confirm('確定刪除這筆花費？')) {
                    this.currentDayData.expenses.splice(idx, 1);
                    this.saveData();
                }
            },
            handlePhotoUpload(event, eventData) {
                const file = event.target.files[0];
                if (!file) return;

                // 限制大小 (避免 LocalStorage 爆掉)
                if (file.size > 2 * 1024 * 1024) {
                    alert("照片太大囉！請選用 2MB 以下的照片，以免 App 變慢。");
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    // 這裡可以做 Canvas 壓縮，簡化起見直接存 Base64
                    // 為了省空間，實際專案建議用 Canvas 縮圖，這裡直接存
                    if(!eventData.photos) eventData.photos = [];
                    eventData.photos.push(e.target.result);
                    this.saveData();
                };
                reader.readAsDataURL(file);
            },
            removePhoto(eventData, index) {
                if(confirm('要刪除這張照片嗎？')) {
                    eventData.photos.splice(index, 1);
                    this.saveData();
                }
            },
            saveData() {
                try {
                    localStorage.setItem('trip_japan_2025_v1', JSON.stringify(this.days));
                } catch (e) {
                    alert("儲存空間已滿！請刪除一些照片再試。");
                }
            },
            loadData() {
                const saved = localStorage.getItem('trip_japan_2025_v1');
                if (saved) {
                    this.days = JSON.parse(saved);
                }
            },
            clearAllData() {
                if(confirm("警告：這將會刪除您所有的筆記、照片和記帳紀錄，恢復成原始行程表。確定嗎？")) {
                    localStorage.removeItem('trip_japan_2025_v1');
                    location.reload();
                }
            }
        }
    }).mount('#app');
</script>

</body>
</html>
